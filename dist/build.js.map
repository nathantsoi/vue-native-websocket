{"version":3,"file":"build.js","mappings":"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","sources":["webpack://VueNativeSock/webpack/universalModuleDefinition","webpack://VueNativeSock/webpack/bootstrap","webpack://VueNativeSock/webpack/runtime/define property getters","webpack://VueNativeSock/webpack/runtime/hasOwnProperty shorthand","webpack://VueNativeSock/webpack/runtime/make namespace object","webpack://VueNativeSock/./node_modules/@babel/runtime/helpers/esm/classCallCheck.js","webpack://VueNativeSock/./node_modules/@babel/runtime/helpers/esm/createClass.js","webpack://VueNativeSock/./src/Emitter.js","webpack://VueNativeSock/./src/Observer.js","webpack://VueNativeSock/./src/Main.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"VueNativeSock\"] = factory();\n\telse\n\t\troot[\"VueNativeSock\"] = factory();\n})(self, () => {\nreturn ","// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","export default function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nexport default function _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, \"prototype\", {\n    writable: false\n  });\n  return Constructor;\n}","class Emitter {\n  constructor () {\n    this.listeners = new Map()\n  }\n\n  addListener (label, callback, vm) {\n    if (typeof callback === 'function') {\n      this.listeners.has(label) || this.listeners.set(label, [])\n      this.listeners.get(label).push({ callback, vm })\n      return true\n    }\n    return false\n  }\n\n  removeListener (label, callback, vm) {\n    const listeners = this.listeners.get(label)\n    let index\n\n    if (listeners && listeners.length) {\n      index = listeners.reduce((i, listener, index) => {\n        if (typeof listener.callback === 'function' && listener.callback === callback && listener.vm === vm) {\n          i = index\n        }\n        return i\n      }, -1)\n\n      if (index > -1) {\n        listeners.splice(index, 1)\n        this.listeners.set(label, listeners)\n        return true\n      }\n    }\n    return false\n  }\n\n  emit (label, ...args) {\n    const listeners = this.listeners.get(label)\n\n    if (listeners && listeners.length) {\n      listeners.forEach((listener) => {\n        listener.callback.call(listener.vm, ...args)\n      })\n      return true\n    }\n    return false\n  }\n}\n\nexport default new Emitter()\n","import Emitter from './Emitter'\n\nexport default class {\n  constructor (connectionUrl, opts = {}) {\n    this.format = opts.format && opts.format.toLowerCase()\n\n    if (connectionUrl.startsWith('//')) {\n      const scheme = window.location.protocol === 'https:' ? 'wss' : 'ws'\n      connectionUrl = `${scheme}:${connectionUrl}`\n    }\n\n    this.connectionUrl = connectionUrl\n    this.opts = opts\n\n    this.reconnection = this.opts.reconnection || false\n    this.reconnectionAttempts = this.opts.reconnectionAttempts || Infinity\n    this.reconnectionDelay = this.opts.reconnectionDelay || 1000\n    this.reconnectTimeoutId = 0\n    this.reconnectionCount = 0\n\n    this.passToStoreHandler = this.opts.passToStoreHandler || false\n\n    this.connect(connectionUrl, opts)\n\n    if (opts.store) { this.store = opts.store }\n    if (opts.mutations) { this.mutations = opts.mutations }\n    this.onEvent()\n  }\n\n  connect (connectionUrl, opts = {}) {\n    const protocol = opts.protocol || ''\n    this.WebSocket = opts.WebSocket || (protocol === '' ? new WebSocket(connectionUrl) : new WebSocket(connectionUrl, protocol))\n    if (this.format === 'json') {\n      if (!('sendObj' in this.WebSocket)) {\n        this.WebSocket.sendObj = (obj) => this.WebSocket.send(JSON.stringify(obj))\n      }\n    }\n\n    return this.WebSocket\n  }\n\n  reconnect () {\n    if (this.reconnectionCount <= this.reconnectionAttempts) {\n      this.reconnectionCount++\n      clearTimeout(this.reconnectTimeoutId)\n\n      this.reconnectTimeoutId = setTimeout(() => {\n        if (this.store) { this.passToStore('SOCKET_RECONNECT', this.reconnectionCount) }\n\n        this.connect(this.connectionUrl, this.opts)\n        this.onEvent()\n      }, this.reconnectionDelay)\n    } else {\n      if (this.store) { this.passToStore('SOCKET_RECONNECT_ERROR', true) }\n    }\n  }\n\n  onEvent () {\n    ['onmessage', 'onclose', 'onerror', 'onopen'].forEach((eventType) => {\n      this.WebSocket[eventType] = (event) => {\n        Emitter.emit(eventType, event)\n\n        if (this.store) { this.passToStore('SOCKET_' + eventType, event) }\n\n        if (this.reconnection && eventType === 'onopen') {\n          this.opts.$setInstance(event.currentTarget)\n          this.reconnectionCount = 0\n        }\n\n        if (this.reconnection && eventType === 'onclose') { this.reconnect() }\n      }\n    })\n  }\n\n  passToStore (eventName, event) {\n    if (this.passToStoreHandler) {\n      this.passToStoreHandler(eventName, event, this.defaultPassToStore.bind(this))\n    } else {\n      this.defaultPassToStore(eventName, event)\n    }\n  }\n\n  defaultPassToStore (eventName, event) {\n    if (!eventName.startsWith('SOCKET_')) { return }\n    let method = 'commit'\n    let target = eventName.toUpperCase()\n    let msg = event\n    if (this.format === 'json' && event.data) {\n      msg = JSON.parse(event.data)\n      if (msg.mutation) {\n        target = [msg.namespace || '', msg.mutation].filter((e) => !!e).join('/')\n      } else if (msg.action) {\n        method = 'dispatch'\n        target = [msg.namespace || '', msg.action].filter((e) => !!e).join('/')\n      }\n    }\n    if (this.mutations) {\n      target = this.mutations[target] || target\n    }\n    this.store[method](target, msg)\n  }\n}\n","import Observer from './Observer'\nimport Emitter from './Emitter'\n\nexport default {\n\n  install (Vue, connection, opts = {}) {\n    if (!connection && !opts.connectManually) { throw new Error('[vue-native-socket] cannot locate connection') }\n\n    let observer = null\n\n    opts.$setInstance = (wsInstance) => {\n      Vue.prototype.$socket = wsInstance\n    }\n\n    if (opts.connectManually) {\n      Vue.prototype.$connect = (connectionUrl = connection, connectionOpts = opts) => {\n        connectionOpts.$setInstance = opts.$setInstance\n        observer = new Observer(connectionUrl, connectionOpts)\n        Vue.prototype.$socket = observer.WebSocket\n      }\n\n      Vue.prototype.$disconnect = () => {\n        if (observer && observer.reconnection) {\n          observer.reconnection = false\n          clearTimeout(observer.reconnectTimeoutId)\n        }\n        if (Vue.prototype.$socket) {\n          Vue.prototype.$socket.close()\n          delete Vue.prototype.$socket\n        }\n      }\n    } else {\n      observer = new Observer(connection, opts)\n      Vue.prototype.$socket = observer.WebSocket\n    }\n    const hasProxy = typeof Proxy !== 'undefined' && typeof Proxy === 'function' && /native code/.test(Proxy.toString())\n\n    Vue.mixin({\n      created () {\n        const vm = this\n        const sockets = this.$options.sockets\n\n        if (hasProxy) {\n          this.$options.sockets = new Proxy({}, {\n            set (target, key, value) {\n              Emitter.addListener(key, value, vm)\n              target[key] = value\n              return true\n            },\n            deleteProperty (target, key) {\n              Emitter.removeListener(key, vm.$options.sockets[key], vm)\n              delete target.key\n              return true\n            }\n          })\n          if (sockets) {\n            Object.keys(sockets).forEach((key) => {\n              this.$options.sockets[key] = sockets[key]\n            })\n          }\n        } else {\n          Object.seal(this.$options.sockets)\n\n          // if !hasProxy need addListener\n          if (sockets) {\n            Object.keys(sockets).forEach(key => {\n              Emitter.addListener(key, sockets[key], vm)\n            })\n          }\n        }\n      },\n      beforeDestroy () {\n        if (hasProxy) {\n          const sockets = this.$options.sockets\n\n          if (sockets) {\n            Object.keys(sockets).forEach((key) => {\n              delete this.$options.sockets[key]\n            })\n          }\n        }\n      }\n    })\n  }\n}\n"],"names":["root","factory","exports","module","define","amd","self","__webpack_require__","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","configurable","writable","_createClass","protoProps","staticProps","Emitter","this","listeners","Map","label","callback","vm","has","set","push","index","reduce","listener","splice","args","forEach","connectionUrl","opts","format","toLowerCase","startsWith","scheme","window","location","protocol","reconnection","reconnectionAttempts","Infinity","reconnectionDelay","reconnectTimeoutId","reconnectionCount","passToStoreHandler","connect","store","mutations","onEvent","WebSocket","sendObj","send","JSON","stringify","clearTimeout","setTimeout","passToStore","eventType","event","$setInstance","currentTarget","reconnect","eventName","defaultPassToStore","bind","method","toUpperCase","msg","data","parse","mutation","namespace","filter","e","join","action","install","Vue","connection","connectManually","Error","observer","wsInstance","$socket","$connect","connectionOpts","Observer","$disconnect","close","hasProxy","Proxy","test","toString","mixin","created","sockets","$options","deleteProperty","keys","seal","beforeDestroy"],"sourceRoot":""}